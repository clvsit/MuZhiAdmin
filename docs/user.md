# 权限管理模块
## 获取权限角色信息
若当前用户拥有权限管理权限，则可以获取后台管理系统的权限信息。

【说明】：

- 超级管理员：可以分配管理员，且无法被其他管理员识别。超级管理员不存储在数据库中，而是存放到配置文件中，并需要进行加密处理。
- 管理员：能够管理除管理员身份外的所有权限角色。

#### 前端请求
- 请求方式：GET
- 请求地址：/admin/auth/get
- 请求参数：无
- 请求示例：无

#### 后台响应
- 操作视图：view\_auth
- 返回字段：权限号、角色名称、创建日期、修改日期、修改人、权限内容。
- 响应示例：

```JSON
// 请求成功
{
    code: "1",
    msg: "获取权限列表成功！",
    data: {
        "authList": [
            {
                "id": 1,
                "name": "管理员",
                "dateCreate": "2019-01-05 15:31",
                "dateModify": "2019-01-05 15:31",
                "modifier": "超级管理员",
                "content": "*",
                "contentName": "所有权限"
            }, {
                "id": 2,
                "name": "数据管理人员",
                "dateCreate": "2019-01-09 15:31",
                "dateModify": "2019-01-09 15:31",
                "modifier": "测试人员",
                "content": "1",
                "contentName": "数据管理"
            }, {
                "id": 3,
                "name": "系统测试人员",
                "dateCreate": "2019-01-09 15:31",
                "dateModify": "2019-01-09 15:31",
                "modifier": "测试人员",
                "content": "1|2",
                "contentName": "用户管理、数据管理"
            }
        ]
    }
}

// 请求失败
{
    "code": "0",
    "msg": "具体的错误信息",
    "data": {}
}
```
【说明】：由于权限表存储的权限形式为 “1|2”，因此在表连接的时候非常难以处理，直接在页面显示 “1|2” 肯定是不行，需要通过一种转换将 "1|2" 转换为对应的内容。这部分内容如果后台可以处理，就由后台来处理，要是麻烦的话，就让前台来实现。

## 添加权限信息
拥有用户管理权限的用户可以添加新的权限角色为信息。

#### 前端请求
- 请求方式：POST
- 请求地址：/admin/auth/add
- 请求参数：角色名称（kiwua）、权限内容（mwbqs）、用户账号（wicha）
- 请求示例：

```
kiwua: "系统管理员"
mwbqs："1|2"
wicha: "MTU0NzE5MjE3MDEzMmpzdWNoZW4="
```
【说明】：用户账号需要进行加密和解密。前端会进行 base64 加密，后台在收到后对其进行解密。

#### 后台响应
- 操作数据表：pauth、nwatch
- 返回字段：无
- 响应示例：

```JSON
// 请求成功
{
    code: "1",
    msg: "新增权限信息成功",
    data: {}
}

// 请求失败
{
    "code": "0",
    "msg": "具体的错误信息",
    "data": {}
}
```
【操作过程】：

- 首先将前端传递的**角色名称**插入到 pauth 表中。
- 然后再获取服务器的时间戳和系统日期（符合 nwatch Ndate 字段的要求）。
- 接着根据不同的接口生成对应的**操作内容**，例如添加菜单信息接口对应的操作内容就是**添加权限信息**。
- 最后将时间戳、系统日期、操作内容以及前端传递的用户名称一并插入到 nwatch 表中。

【说明】：后续的接口操作过程同**添加权限信息**。

## 编辑权限信息
拥有用户管理权限的用户可以编辑已有的权限信息。

#### 前端请求
- 请求方式：POST
- 请求地址：/admin/auth/edit
- 请求参数：权限号（qcsua）、权限内容（uqysh）、角色名称（mcqjs）、用户账号（ahsjs）
- 请求示例：

```
qcsua：1
uqysh: "管理者"
mcqjs："1|2"
ahsjs: "MTU0NzE5MjE3MDEzMmpzdWNoZW4="
```

#### 后台响应
- 操作数据表：pauth、nwatch
- 返回字段：无
- 响应示例：

```JSON
// 请求成功
{
    code: "1",
    msg: "编辑权限信息成功",
    data: {}
}

// 请求失败
{
    "code": "0",
    "msg": "具体的错误信息",
    "data": {}
}
```
【注意】：需要更新 pauth 记录的**修改日期**和**修改人**两个字段的值。修改日期取当前系统时间，修改人则由前端提供的**用户账号**。

## 删除权限信息
拥有用户管理权限的用户可以删除已有的权限信息。

#### 前端请求
- 请求方式：POST
- 请求地址：/admin/auth/del
- 请求参数：权限号（nckaj）、用户账号（fhsja）
- 请求示例：

```
nckaj：1
fhsja: "MTU0NzE5MjE3MDEzMmpzdWNoZW4="
```

#### 后台响应
- 操作数据表：pauth、nwatch
- 返回字段：无
- 响应示例：

```JSON
// 请求成功
{
    code: "1",
    msg: "删除权限信息成功",
    data: {}
}

// 请求失败
{
    "code": "0",
    "msg": "具体的错误信息",
    "data": {}
}
```
【说明】：当删除指定的权限角色之后，需要将分配该权限角色的所有用户的权限角色设置为未激活（kadmin 的 Bauth 字符设置为 2）。

# 员工管理模块
## 获取员工信息
若当前用户拥有权限管理权限，则可以获取后台管理系统的员工信息。

![获取员工信息](https://i.imgur.com/uBt3D4s.png)

【说明】：

- 超级管理员：可以查看和管理除自身以外的所有员工信息，包括管理员。
- 拥有用户管理权限的员工：可以查看和管理除超级管理员和管理员之外的所有员工信息。

#### 前端请求
- 请求方式：GET
- 请求地址：/admin/employee/get
- 请求参数：起始日期（cjajw）、结束日期（cqojs）、检索条件（qyquc）、检索内容（kcnal）、权限角色（coqsd）、起始记录数（twyiq）、每页记录数（jkams）、
- 请求示例：

```
cjajw: "2019-01-01"
cqojs: "2019-01-12"
qyquc: 0
kcnal: "测试一号"
coqsd: 1
twyiq: 0
jkams: 20
```
【说明-检索条件】：

- -1：没有检索条件
- 0：员工工号
- 1：员工姓名
- 2：手机号码
- 3：登录人工号

【说明-权限角色】：

- -1：所有角色
- 具体数字：对应角色

#### 后台响应
- 操作视图：view_admin
- 返回字段：员工工号、员工姓名、员工邮箱、手机号码、权限号、权限角色名称、登录日期、登录人。
- 响应示例：

```JSON
// 请求成功
{
    code: "1",
    msg: "获取用户列表成功！",
    data: {
        count: 150,
        userList: [
            {
                "id": "@word(13)",
                "name": "@cname()",
                "email": "@email()",
                "phone|13000000000-17000000000": 1,
                "auth": "1",
                "authName": "普通人员",
                "dateCreate": "@date('yyyy-MM-dd HH:mm')",
                "creater": "@cname()"
            }
        ]
    }
}

// 请求失败
{
    "code": "0",
    "msg": "具体的错误信息",
    "data": {}
}
```
【说明】：返回示例使用 mock.js 自动生成，具体数据可参考如下图。

## 添加员工信息
拥有用户管理权限的用户可以添加新的员工信息。

![添加员工信息](https://i.imgur.com/dTU12s2.png)

#### 前端请求
- 请求方式：POST
- 请求地址：/admin/employee/add
- 请求参数：员工账号（uqnck）、员工姓名（tqhck）、员工邮箱（nkalc）、手机号码（ckqbk）、权限角色（cajiw）、操作者员工号（cjiqs）
- 请求示例：

```
uqnck: "MTU0NzE5MjE3MDEzMmpzdWNoZW5="
tqhck: "测试一号"
nkalc: "ceshi@163.com"
ckqbk: "17826857055"
cajiw: 1
cjiqs: "1547471797664"
```
【说明】：员工账号需要进行加密和解密。前端会进行 base64 加密，后台在收到后对其进行解密。

#### 后台响应
- 操作数据表：kadmin、nwatch
- 返回字段：无
- 响应示例：

```JSON
// 请求成功
{
    code: "1",
    msg: "新增员工信息成功",
    data: {}
}

// 请求失败
{
    "code": "0",
    "msg": "具体的错误信息",
    "data": {}
}
```
【操作过程-kadmin】：

- 将前端传递的参数依次插入到 kadmin 表的指定字段，登录日期取当前系统时间（注意格式），登录人则填写前端传递的“操作者账号”。

【操作过程-nwatch】：

- 先获取服务器的时间戳和系统日期（符合 nwatch Ndate 字段的要求）。
- 接着根据不同的接口生成对应的**操作内容**，例如添加员工信息接口对应的操作内容就是**添加员工信息**。
- 最后将时间戳、系统日期、操作内容以及前端传递的用户名称一并插入到 nwatch 表中。

【说明】：后续的接口操作过程同**添加员工信息**。

## 编辑员工信息
拥有用户管理权限的用户可以编辑已有员工的信息。

![编辑员工信息](https://i.imgur.com/vaQoiw4.png)

#### 前端请求
- 请求方式：POST
- 请求地址：/admin/employee/edit
- 请求参数：员工号（jchan）、员工姓名（bqhsm）、员工邮箱（ncbak）、手机号码（uqihc）、权限角色（cnakv）、操作者员工号（jqscm）
- 请求示例：

```
jchan: "1547471774769"
bqhsm: "朱娜"
ncbak: "p.mnhfavng@grirxwt.dz"
uqihc: "15585858447"
cnakv: 1
jqscm: "1547471797664"
```

#### 后台响应
- 操作数据表：kadmin、nwatch
- 返回字段：无
- 响应示例：

```JSON
// 请求成功
{
    code: "1",
    msg: "编辑员工信息成功",
    data: {}
}

// 请求失败
{
    "code": "0",
    "msg": "具体的错误信息",
    "data": {}
}
```

## 删除员工信息
拥有用户管理权限的用户可以删除已有的员工信息。

![删除员工信息](https://i.imgur.com/Ob2of0O.jpg)

#### 前端请求
- 请求方式：POST
- 请求地址：/admin/employee/del
- 请求参数：员工号（cjwqk）、操作者员工号（yqjac）
- 请求示例：

```
cjwqk："1547471774769"
yqjac: "1547471797664"
```

#### 后台响应
- 操作数据表：kadmin、nwatch
- 返回字段：无
- 响应示例：

```JSON
// 请求成功
{
    code: "1",
    msg: "删除员工信息成功",
    data: {}
}

// 请求失败
{
    "code": "0",
    "msg": "具体的错误信息",
    "data": {}
}
```